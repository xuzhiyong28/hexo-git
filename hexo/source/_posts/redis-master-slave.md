---
title: redis主从复制原理
tags:
  - redis
categories: redis
description : redis主从复制原理
date: 2020-08-20 09:09:59
---
## Redis主从复制配置
```shell
127.0.0.1:6380> SLAVEOF 127.0.0.1 6379
```

## 原理详解

redis的复制功能分为**同步**和**命令传播**两个操作。
- 同步操作，将从服务器的数据库状态更新至主服务器当前所处的数据库状态。
- 命令传播操，在主服务器的数据库状态被修改导致主从服务器的数据库状态出现不一致时，让主从服务器的数据库重新回到一致状态。

### 同步

同步的过程包括如下：

1. 从服务器向主服务器发送SYNC命令。
2. 收到SYNC后主服务器执行BGSAVE命令生成RDB文件，期间并使用一个缓冲区记录从现在开始执行的所有写命令。
3. BGSAVE命令执行完毕后，主服务器会将BGSAVE命令生成的RDB文件发送给从服务器。
4. 从服务器接收并载入RDB文件，将状态更新与主服务器一致。



### 命令传播

xxx