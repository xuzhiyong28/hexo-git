{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"themes/volantis/source/css/style.styl","path":"css/style.styl","modified":1,"renderable":1},{"_id":"themes/volantis/source/fonts/Monaco.ttf","path":"fonts/Monaco.ttf","modified":1,"renderable":1},{"_id":"themes/volantis/source/img/algolia.svg","path":"img/algolia.svg","modified":1,"renderable":1},{"_id":"themes/volantis/source/img/azure.svg","path":"img/azure.svg","modified":1,"renderable":1},{"_id":"themes/volantis/source/img/baidu.svg","path":"img/baidu.svg","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/app.js","path":"js/app.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/search.js","path":"js/search.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/fonts/Skranji-Regular.ttf","path":"fonts/Skranji-Regular.ttf","modified":1,"renderable":1},{"_id":"themes/volantis/source/js/valine.js","path":"js/valine.js","modified":1,"renderable":1},{"_id":"themes/volantis/source/fonts/Ubuntu-Regular.ttf","path":"fonts/Ubuntu-Regular.ttf","modified":1,"renderable":1}],"Cache":[{"_id":"themes/volantis/.gitignore","hash":"4b5e4eb66070da8433cd43d75af0de341e04a2ed","modified":1595250283359},{"_id":"themes/volantis/LICENSE","hash":"e0cbf6906cab5926a34f17852db6c05187ee1f68","modified":1595250283359},{"_id":"themes/volantis/README.md","hash":"91f213a172dd9e57e4ef03c9151ad94ec1bb2690","modified":1595250283359},{"_id":"themes/volantis/_config.yml","hash":"3bf61a6ed5d7ce967ae58514120019b6b604e1b8","modified":1595250283360},{"_id":"source/_posts/db-w-r-dynamic.md","hash":"73633eef8a438e515e8303b2e6ab143dc2ba176c","modified":1595251173520},{"_id":"source/_posts/myblob.md","hash":"4be2ae2ed53c78f6c4d9ff29f83ad6c49836ad95","modified":1595250283322},{"_id":"source/_posts/hello-world.md","hash":"6b9c5669b13f4d29a510acd4c4ff046f3486bc5f","modified":1595250283322},{"_id":"themes/volantis/languages/en.yml","hash":"809cbd1198ff45440e2997a22be34ae94367f92d","modified":1595250283361},{"_id":"themes/volantis/languages/zh-CN.yml","hash":"2735c9942ba1ece0124cf65cbc2101a54eb3e0d6","modified":1595250283361},{"_id":"themes/volantis/languages/zh-TW.yml","hash":"99962c8d9b941b85395dc73d581aaf927b19275b","modified":1595250283361},{"_id":"themes/volantis/layout/404.ejs","hash":"805804c27fcdb07201d38162361c606a167b44e9","modified":1595250283362},{"_id":"themes/volantis/layout/_pre.ejs","hash":"bdbcf68e3f71df73bc59ffa5007d8fe800c5cdc1","modified":1595250283371},{"_id":"themes/volantis/layout/archive.ejs","hash":"39760a20302fe11b8e12a7e32665bbe8477ac204","modified":1595250283396},{"_id":"themes/volantis/layout/category.ejs","hash":"45345ffec8a9a737ffd767c4cce4dfed30930e20","modified":1595250283396},{"_id":"themes/volantis/layout/index.ejs","hash":"6fee00696b3de0b7440cf1b4c2c099f19c2580f8","modified":1595250283396},{"_id":"themes/volantis/layout/layout.ejs","hash":"872f54691e2e6cc2ed36caab551d04a157b3dd94","modified":1595250283397},{"_id":"themes/volantis/layout/links.ejs","hash":"1bebe4b632945d33f36e2fc446c48ff4dda65819","modified":1595250283397},{"_id":"themes/volantis/layout/page.ejs","hash":"e1285b47ace87cbcf0ab459ab2d51567e3d43bba","modified":1595250283398},{"_id":"themes/volantis/layout/list.ejs","hash":"5d1efdee83a9979996b34fc743ac957517be5bb4","modified":1595250283397},{"_id":"themes/volantis/layout/post.ejs","hash":"e1285b47ace87cbcf0ab459ab2d51567e3d43bba","modified":1595250283398},{"_id":"themes/volantis/layout/tag.ejs","hash":"ea2058e970a8a5c933c6b0180d8fc8f4985e6dea","modified":1595250283398},{"_id":"themes/volantis/layout/_cover/index.ejs","hash":"cdf5c5e17a57cda45fdb890c8f061f3f39202ca2","modified":1595250283362},{"_id":"themes/volantis/layout/_meta/author.ejs","hash":"6abae4a1e188d2f059b841d6f466c8b77918ab66","modified":1595250283363},{"_id":"themes/volantis/layout/_meta/btns.ejs","hash":"e4004bbb7a2bf46dfc95cd610822c0d58e7af6b7","modified":1595250283363},{"_id":"themes/volantis/layout/_meta/category.ejs","hash":"1a801cf409dc24fd4ea1f90c9941b74890a16ec3","modified":1595250283363},{"_id":"themes/volantis/layout/_meta/counter.ejs","hash":"65168cd369fd0ff442b07a7d84bca12bd68b37bf","modified":1595250283364},{"_id":"themes/volantis/layout/_meta/date.ejs","hash":"e18dd6f5ea703ebd7afe50d4e94fdce8e33e71b3","modified":1595250283364},{"_id":"themes/volantis/layout/_meta/share.ejs","hash":"d1aca13ece4278daf470e801b23b7546959a5b4e","modified":1595250283365},{"_id":"themes/volantis/layout/_meta/music.ejs","hash":"32e95a5ad95bf799b58ca9f4d595c201d64e372e","modified":1595250283364},{"_id":"themes/volantis/layout/_meta/tags.ejs","hash":"111c399d6b90e2cda99d9d846c60e0a65bcd7e2d","modified":1595250283365},{"_id":"themes/volantis/layout/_meta/thumbnail.ejs","hash":"8afd94949e88f7c0373974234c6f80ed858705c7","modified":1595250283365},{"_id":"themes/volantis/layout/_meta/title.ejs","hash":"fd8c7b0011d4e9c5b3aad4f3a0a058cb6c33c05c","modified":1595250283366},{"_id":"themes/volantis/layout/_meta/top.ejs","hash":"4e7f1b980942b15eb5b15e43d969c4a0d3ad921f","modified":1595250283366},{"_id":"themes/volantis/layout/_meta/updated.ejs","hash":"4e6ed816c7ff181c820d1976e4557bcfb1486bc2","modified":1595250283367},{"_id":"themes/volantis/layout/_meta/wordcount.ejs","hash":"6d75bcb787ce216b45830c52e3a69b0b2630110e","modified":1595250283367},{"_id":"themes/volantis/layout/_partial/archive.ejs","hash":"4f3ec993e4498d0a9cd6e3f9aa796cbf6e659571","modified":1595250283367},{"_id":"themes/volantis/layout/_partial/article.ejs","hash":"0ac0daa27fa74185837c7d25593400d1aab2a2e9","modified":1595250283368},{"_id":"themes/volantis/layout/_partial/categories.ejs","hash":"7c7b6cc39e1aa8d01cc2e94d1195bb7620bb68ea","modified":1595250283368},{"_id":"themes/volantis/layout/_partial/cover.ejs","hash":"5beb8271519bccc1297381effd5de7f6cbf3cd7d","modified":1595250283368},{"_id":"themes/volantis/layout/_partial/footer.ejs","hash":"5f52f4e182e5329366ff1120df83e84553d339e3","modified":1595250283369},{"_id":"themes/volantis/layout/_partial/head.ejs","hash":"ce965fcfe6109fa4a03491421651be1c6688c2b4","modified":1595250283369},{"_id":"themes/volantis/layout/_partial/header.ejs","hash":"1c6ce0c39a0d6f76df4205d8d922e052a93d3b0c","modified":1595250283370},{"_id":"themes/volantis/layout/_partial/meta.ejs","hash":"35a7ca48dda87e414abb924468a9dcdcac0aca00","modified":1595250283370},{"_id":"themes/volantis/layout/_partial/post.ejs","hash":"b4f9de79f5d153898685de976218c5ff10175d35","modified":1595250283370},{"_id":"themes/volantis/layout/_partial/scripts.ejs","hash":"0086a9122a2a18ab1ecb89740ac9127e3efac72e","modified":1595250283371},{"_id":"themes/volantis/layout/_partial/side.ejs","hash":"8fcd8edfaa77a9f2b8ec93268c9448e515b46254","modified":1595250283371},{"_id":"themes/volantis/layout/_third-party/aplayer.ejs","hash":"e520ca71b9c5a8b9eb383d82ca741efcc753ee47","modified":1595250283372},{"_id":"themes/volantis/layout/_third-party/clipboard.ejs","hash":"88266c917e7283a6c76c382ac5fa7507729d586e","modified":1595250283373},{"_id":"themes/volantis/layout/_third-party/comments.ejs","hash":"9b1910c8900b2e4f0fd97922a83a0143c88cad77","modified":1595250283373},{"_id":"themes/volantis/layout/_third-party/fancybox.ejs","hash":"43a218adabbb875f8052d552ec045c7844717f24","modified":1595250283374},{"_id":"themes/volantis/layout/_third-party/mathjax.ejs","hash":"7a041dc40a291f5e75ffdc6f9cd04f49ac00f475","modified":1595250283375},{"_id":"themes/volantis/layout/_third-party/share.ejs","hash":"c94992ac78cbf97858f0cebc4a239ac8ab9fca55","modified":1595250283375},{"_id":"themes/volantis/layout/_widget/blogger.ejs","hash":"a7762c1b189ba5a644d140a3dbf9206864505d3c","modified":1595250283390},{"_id":"themes/volantis/layout/_widget/_pre.ejs","hash":"be59b18c8816d469e2d24fa644d7dc105ed2f850","modified":1595250283376},{"_id":"themes/volantis/layout/_widget/copyright.ejs","hash":"de6870c3cc658c054012c0c700d3e0342de99251","modified":1595250283391},{"_id":"themes/volantis/layout/_widget/category.ejs","hash":"7295c87e3e095018d07af7941232b12970f0fcc5","modified":1595250283390},{"_id":"themes/volantis/layout/_widget/grid.ejs","hash":"6ceb91ad7fecbfaf86342a99656767c76bca357d","modified":1595250283391},{"_id":"themes/volantis/layout/_widget/group.ejs","hash":"28955bae655056275b5b6313a296c4601c9f421c","modified":1595250283392},{"_id":"themes/volantis/layout/_widget/header.ejs","hash":"b54a04af22efd55585af6e76ddbb7e856c5e9601","modified":1595250283392},{"_id":"themes/volantis/layout/_widget/list.ejs","hash":"eac7e6b422049eff92e2eaff892519c9058dc342","modified":1595250283393},{"_id":"themes/volantis/layout/_widget/load.ejs","hash":"ebfb18816e32dd657eb6ecdb91e8f885e9e6d85e","modified":1595250283393},{"_id":"themes/volantis/layout/_widget/music.ejs","hash":"92f156ef87392f7842c72540367ae452d85b2d63","modified":1595250283394},{"_id":"themes/volantis/layout/_widget/page.ejs","hash":"49ee453f2694a978dc159a39667e74d6b5b139e5","modified":1595250283394},{"_id":"themes/volantis/layout/_widget/qrcode.ejs","hash":"0209fc678cf2e7d0bf35be6a4b572598c150515d","modified":1595250283394},{"_id":"themes/volantis/layout/_widget/references.ejs","hash":"99621003f5c8ec8aac7cbbb10924b33c9e2a705d","modified":1595250283395},{"_id":"themes/volantis/layout/_widget/related_posts.ejs","hash":"92754a4f747299709cda4e32a1eecb6ec54265ef","modified":1595250283395},{"_id":"themes/volantis/layout/_widget/tagcloud.ejs","hash":"e58c16a7671a3575cfec7093a24267d97f84646f","modified":1595250283395},{"_id":"themes/volantis/layout/_widget/text.ejs","hash":"a6e2d9e52008b548e1863355d319504abb59fabb","modified":1595250283395},{"_id":"themes/volantis/layout/_widget/toc.ejs","hash":"14e2078fcee0dabc10f37be53a065a8d1932dcfc","modified":1595250283396},{"_id":"themes/volantis/scripts/events/index.js","hash":"a0f10031807f8c58c99085cfe95d850269ca709b","modified":1595250283399},{"_id":"themes/volantis/scripts/tags/btn.js","hash":"b89a1a6a889ed5b54b2d9a5c63493fa35934e3aa","modified":1595250283400},{"_id":"themes/volantis/scripts/tags/btns.js","hash":"84f9f17a2b73ab84d0a4e0980e393a00807db4ec","modified":1595250283400},{"_id":"themes/volantis/scripts/tags/checkbox.js","hash":"636cef0f4500a14b123c6b21187fb67989472cbd","modified":1595250283401},{"_id":"themes/volantis/scripts/tags/dropmenu.js","hash":"5af4b247d1c05681455a3538949a95486f65eea8","modified":1595250283401},{"_id":"themes/volantis/scripts/tags/fancybox.js","hash":"775cfaccf7fc77dc9cbebe64bddcfe68eeafef4b","modified":1595250283401},{"_id":"themes/volantis/scripts/tags/folding.js","hash":"13cde292311a8d00f5d149a171f3d0f3251e20da","modified":1595250283402},{"_id":"themes/volantis/scripts/tags/image.js","hash":"6b575b64f6e185583794c6bb38a3f2a6d92b3ca0","modified":1595250283402},{"_id":"themes/volantis/scripts/tags/media.js","hash":"ebe4a6ebe34e8d77c0652c63bd5f763439743eb2","modified":1595250283418},{"_id":"themes/volantis/scripts/tags/note.js","hash":"21b6180562952b425e884dad73af3728179fb675","modified":1595250283430},{"_id":"themes/volantis/scripts/tags/span.js","hash":"89aaa0678188aa85ec18116af4b036f80ca7c073","modified":1595250283430},{"_id":"themes/volantis/scripts/tags/tabs.js","hash":"c59daf8a06e3a355663b89a7ab5445cdec5384fd","modified":1595250283430},{"_id":"themes/volantis/source/css/style.styl","hash":"1495c9f380ef3767b77251dfbb30d2cefe78ca4d","modified":1595250283518},{"_id":"themes/volantis/source/fonts/Monaco.ttf","hash":"d4de9305ce9e916ece179c3ab3b1faf80cc52bbb","modified":1595250283519},{"_id":"themes/volantis/source/img/algolia.svg","hash":"f86c0288423ba1b62c3bde06fc38f031af56e5f6","modified":1595250283530},{"_id":"themes/volantis/source/img/azure.svg","hash":"9c42c8070528e28a97705fb410e65100632ae92b","modified":1595250283530},{"_id":"themes/volantis/source/img/baidu.svg","hash":"8f08ba555b4d8b262e2c3b7793dd169760f63880","modified":1595250283531},{"_id":"themes/volantis/source/js/app.js","hash":"ccc2c5bc1df54f416885c5d3cac04af754da9ee7","modified":1595250283532},{"_id":"themes/volantis/source/js/search.js","hash":"f350aa35ddd23a9ccfed7b43043dbb1f5b53964f","modified":1595250283533},{"_id":"source/_posts/db-w-r-dynamic/db1.png","hash":"e0b0e27ac757a07286dd4489837218d24b204d2e","modified":1595250283322},{"_id":"themes/volantis/scripts/events/lib/config.js","hash":"913154f487b0e49c5a7fb0f462ec7fa4c90e87cb","modified":1595250283399},{"_id":"themes/volantis/source/css/_base/index.styl","hash":"ee21eabcb9908fd01c23ae85eb8707f414c03ec7","modified":1595250283441},{"_id":"themes/volantis/source/css/_defines/color.styl","hash":"e597104a59416e7fb4d1572ff5fd0e67f297f964","modified":1595250283442},{"_id":"themes/volantis/source/css/_defines/effect.styl","hash":"065bc72deaea55a248bd1e022d92252f456d7036","modified":1595250283456},{"_id":"themes/volantis/source/css/_defines/fonts.styl","hash":"0234b03f71e7b0ee1c2f2bf48cd37737e2d0b5cd","modified":1595250283457},{"_id":"themes/volantis/source/css/_defines/func.styl","hash":"79aa375a4e3a6c6f2a0ec87fd85c547612296ecb","modified":1595250283458},{"_id":"themes/volantis/source/css/_defines/layout.styl","hash":"1643920e34312eb2f4321998aaacede68a1587db","modified":1595250283480},{"_id":"themes/volantis/source/css/_highlight/index.styl","hash":"53db45fefb84930d5d40ae439464295a2d2dbaad","modified":1595250283481},{"_id":"themes/volantis/source/css/_layout/archive.styl","hash":"67056065d1281bdd176aae97fef87f197d2e407d","modified":1595250283483},{"_id":"themes/volantis/source/css/_layout/article.styl","hash":"62d690ba78262ff5511ee5c491b5035fb2b257d7","modified":1595250283484},{"_id":"themes/volantis/source/css/_layout/cover.styl","hash":"a6db8065545e8620403a9795584cea6d10ee42c5","modified":1595250283485},{"_id":"themes/volantis/source/css/_layout/footer.styl","hash":"b1052db8e5460c825fff635cbed54d5f1bf38af1","modified":1595250283486},{"_id":"themes/volantis/source/css/_layout/friends.styl","hash":"8f5cc4d8ca1caec43fc9d257a1901322ab66e8a5","modified":1595250283487},{"_id":"themes/volantis/source/css/_layout/main.styl","hash":"6b8a19f8b820d3cce8c99f956d85dd5af500ba82","modified":1595250283488},{"_id":"themes/volantis/source/css/_layout/navbar.styl","hash":"188d38fc833d8d144220e2baa639ee007b90daa6","modified":1595250283489},{"_id":"themes/volantis/source/css/_layout/pagination.styl","hash":"9036915102a38c51f012929a6d7d5ce80c5db937","modified":1595250283490},{"_id":"themes/volantis/source/css/_layout/search.styl","hash":"1c59d6f1a45b30cc367716d340b06808a6cf5709","modified":1595250283491},{"_id":"themes/volantis/source/css/_layout/sidebar.styl","hash":"540b86a614b07955d6caea91a73f1e904141c1eb","modified":1595250283492},{"_id":"themes/volantis/source/css/_layout/toc.styl","hash":"e9d2f43c88d801fa0a4d06821a2fc0fb38e98005","modified":1595250283493},{"_id":"themes/volantis/source/css/_tag-plugins/btns.styl","hash":"a498b10986c6a0a5525753a965842d9dcf2dffdb","modified":1595250283504},{"_id":"themes/volantis/source/css/_tag-plugins/checkbox.styl","hash":"aa14bee36fb93f8dbfe2289ce3be79a42ace2f10","modified":1595250283505},{"_id":"themes/volantis/source/css/_tag-plugins/dropmenu.styl","hash":"95dee4693b259c2cf301732d02f62fc932438bda","modified":1595250283506},{"_id":"themes/volantis/source/css/_tag-plugins/folding.styl","hash":"f3fa87977eaeefb35bafd3de07a31028e2a1217b","modified":1595250283507},{"_id":"themes/volantis/source/css/_tag-plugins/media.styl","hash":"de97807507e324554608c890c7fb54aecfbffd7e","modified":1595250283508},{"_id":"themes/volantis/source/css/_tag-plugins/note.styl","hash":"d57d8bc39e1c357467948b76106921d5e6a88098","modified":1595250283509},{"_id":"themes/volantis/source/css/_tag-plugins/span.styl","hash":"d12727c02efc5cd36ab7878f1dedbbbc2a1d07b3","modified":1595250283510},{"_id":"themes/volantis/source/css/_tag-plugins/tabs.styl","hash":"c33b6d2d7094512819180c72d36101670ed491fd","modified":1595250283511},{"_id":"themes/volantis/source/css/_third-party/aplayer.styl","hash":"2aa314005ced93a5b5b6d9b7b26b613a2ad5cac7","modified":1595250283513},{"_id":"themes/volantis/source/css/_third-party/alert.styl","hash":"b70cf9bb91586c70c70238802165a56b4bee8004","modified":1595250283512},{"_id":"themes/volantis/source/css/_third-party/clipboard.styl","hash":"939053df26a187536414eccadc4114c7ad0e3532","modified":1595250283515},{"_id":"themes/volantis/source/css/_third-party/fancybox.styl","hash":"1a1cbcf39561eb1cf65528d1fe9113f081bce208","modified":1595250283516},{"_id":"themes/volantis/source/css/_third-party/mathjax.styl","hash":"67e530188e29139c63c2c5a296f210c8069b8ef6","modified":1595250283516},{"_id":"themes/volantis/source/css/_third-party/valine.styl","hash":"1655fd3d16c135024a04de8d41fcb10290773c68","modified":1595250283517},{"_id":"themes/volantis/source/fonts/Skranji-Regular.ttf","hash":"485dc033e34a5a92a45ffe5839514f0471b18208","modified":1595250283523},{"_id":"themes/volantis/source/js/valine.js","hash":"f1d97dc61c43d8f40599f35314f0573987fb0d91","modified":1595250283536},{"_id":"themes/volantis/source/fonts/Ubuntu-Regular.ttf","hash":"b100b2ed912a91e4d0a7c5f5309fe8ad7b3a2dd8","modified":1595250283529}],"Category":[],"Data":[],"Page":[],"Post":[{"title":"读写分离设计与思考","description":"高性能数据库集群的第一种方式是“读写分离”","date":"2020-07-20T02:14:00.000Z","_content":"\n## 读写分离基本原理\n\n高性能数据库集群的第一种方式是“***读写分离***”，其本质是将访问压力分散到集群中的多个节点，但是没有分散存储压力；第二种方式是“分库分表”，既可以分散访问压力，又可以分散存储压力。\n\n读写分离的基本实现是：\n\n- 数据库服务器搭建主从集群，一主一从、一主多从都可以\n- 数据库主机负责读写操作，从机只负责读操作\n- 数据库主机通过复制将数据同步到从机，每台数据库服务器都存储了所有的业务数据\n- 业务服务器将写操作发给数据库主机，将读操作发给数据库从机\n\n![](db-w-r-dynamic/db1.png)\n\n\n## 读写分离常见问题与解决\n\n### 主从延迟\n以MYSQL为例，当主库插入数据后从库需要一段时间才能同步，时间可能达到1秒多，如果有大量数同步延迟1分钟也有可能。如果业务服务器将数据写入到数据库主服务器后立刻(1秒内)进行读取，此时读操作访问的是从机，主机还没有将数据复制过来，到从机读取数据是读不到最新数据的，业务上就可能出现问题。\n### 常见解决方法\n1. 关键业务读写操作指向主机，非关键业务采用读写分离。从业务上来区别理论上是比较好的。\n2. 读从机失败后再读一次主机。这种方式与业务无偶尔，只需要在公共类上处理。不足之处在于如果有很多二次读取，将大大增加主机的读操作压力。\n\n## Spring实现读写分离\n\n### 实现代码\n#### 导出MAVEN包\n```\nimport org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;\n\n/***\n * 动态数据库\n */\npublic class DynamicDataSource extends AbstractRoutingDataSource {\n    protected Object determineCurrentLookupKey() {\n        return DBContextHolder.get();\n    }\n}\n```\n\n\n\n\n","source":"_posts/db-w-r-dynamic.md","raw":"---\ntitle: 读写分离设计与思考\ntags:\n  - mysql\n  - 架构\ncategories: []\ndescription : 高性能数据库集群的第一种方式是“读写分离”\ndate: 2020-07-20 10:14:00\n---\n\n## 读写分离基本原理\n\n高性能数据库集群的第一种方式是“***读写分离***”，其本质是将访问压力分散到集群中的多个节点，但是没有分散存储压力；第二种方式是“分库分表”，既可以分散访问压力，又可以分散存储压力。\n\n读写分离的基本实现是：\n\n- 数据库服务器搭建主从集群，一主一从、一主多从都可以\n- 数据库主机负责读写操作，从机只负责读操作\n- 数据库主机通过复制将数据同步到从机，每台数据库服务器都存储了所有的业务数据\n- 业务服务器将写操作发给数据库主机，将读操作发给数据库从机\n\n![](db-w-r-dynamic/db1.png)\n\n\n## 读写分离常见问题与解决\n\n### 主从延迟\n以MYSQL为例，当主库插入数据后从库需要一段时间才能同步，时间可能达到1秒多，如果有大量数同步延迟1分钟也有可能。如果业务服务器将数据写入到数据库主服务器后立刻(1秒内)进行读取，此时读操作访问的是从机，主机还没有将数据复制过来，到从机读取数据是读不到最新数据的，业务上就可能出现问题。\n### 常见解决方法\n1. 关键业务读写操作指向主机，非关键业务采用读写分离。从业务上来区别理论上是比较好的。\n2. 读从机失败后再读一次主机。这种方式与业务无偶尔，只需要在公共类上处理。不足之处在于如果有很多二次读取，将大大增加主机的读操作压力。\n\n## Spring实现读写分离\n\n### 实现代码\n#### 导出MAVEN包\n```\nimport org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;\n\n/***\n * 动态数据库\n */\npublic class DynamicDataSource extends AbstractRoutingDataSource {\n    protected Object determineCurrentLookupKey() {\n        return DBContextHolder.get();\n    }\n}\n```\n\n\n\n\n","slug":"db-w-r-dynamic","published":1,"updated":"2020-07-20T13:19:33.520Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcujgdbf0000e0xlg085gsal","content":"<h2 id=\"读写分离基本原理\"><a href=\"#读写分离基本原理\" class=\"headerlink\" title=\"读写分离基本原理\"></a>读写分离基本原理</h2><p>高性能数据库集群的第一种方式是“<strong><em>读写分离</em></strong>”，其本质是将访问压力分散到集群中的多个节点，但是没有分散存储压力；第二种方式是“分库分表”，既可以分散访问压力，又可以分散存储压力。</p>\n<p>读写分离的基本实现是：</p>\n<ul>\n<li>数据库服务器搭建主从集群，一主一从、一主多从都可以</li>\n<li>数据库主机负责读写操作，从机只负责读操作</li>\n<li>数据库主机通过复制将数据同步到从机，每台数据库服务器都存储了所有的业务数据</li>\n<li>业务服务器将写操作发给数据库主机，将读操作发给数据库从机</li>\n</ul>\n<p><img src=\"/2020/07/20/db-w-r-dynamic/db1.png\" alt></p>\n<h2 id=\"读写分离常见问题与解决\"><a href=\"#读写分离常见问题与解决\" class=\"headerlink\" title=\"读写分离常见问题与解决\"></a>读写分离常见问题与解决</h2><h3 id=\"主从延迟\"><a href=\"#主从延迟\" class=\"headerlink\" title=\"主从延迟\"></a>主从延迟</h3><p>以MYSQL为例，当主库插入数据后从库需要一段时间才能同步，时间可能达到1秒多，如果有大量数同步延迟1分钟也有可能。如果业务服务器将数据写入到数据库主服务器后立刻(1秒内)进行读取，此时读操作访问的是从机，主机还没有将数据复制过来，到从机读取数据是读不到最新数据的，业务上就可能出现问题。</p>\n<h3 id=\"常见解决方法\"><a href=\"#常见解决方法\" class=\"headerlink\" title=\"常见解决方法\"></a>常见解决方法</h3><ol>\n<li>关键业务读写操作指向主机，非关键业务采用读写分离。从业务上来区别理论上是比较好的。</li>\n<li>读从机失败后再读一次主机。这种方式与业务无偶尔，只需要在公共类上处理。不足之处在于如果有很多二次读取，将大大增加主机的读操作压力。</li>\n</ol>\n<h2 id=\"Spring实现读写分离\"><a href=\"#Spring实现读写分离\" class=\"headerlink\" title=\"Spring实现读写分离\"></a>Spring实现读写分离</h2><h3 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h3><h4 id=\"导出MAVEN包\"><a href=\"#导出MAVEN包\" class=\"headerlink\" title=\"导出MAVEN包\"></a>导出MAVEN包</h4><pre><code>import org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;\n\n/***\n * 动态数据库\n */\npublic class DynamicDataSource extends AbstractRoutingDataSource {\n    protected Object determineCurrentLookupKey() {\n        return DBContextHolder.get();\n    }\n}</code></pre>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"读写分离基本原理\"><a href=\"#读写分离基本原理\" class=\"headerlink\" title=\"读写分离基本原理\"></a>读写分离基本原理</h2><p>高性能数据库集群的第一种方式是“<strong><em>读写分离</em></strong>”，其本质是将访问压力分散到集群中的多个节点，但是没有分散存储压力；第二种方式是“分库分表”，既可以分散访问压力，又可以分散存储压力。</p>\n<p>读写分离的基本实现是：</p>\n<ul>\n<li>数据库服务器搭建主从集群，一主一从、一主多从都可以</li>\n<li>数据库主机负责读写操作，从机只负责读操作</li>\n<li>数据库主机通过复制将数据同步到从机，每台数据库服务器都存储了所有的业务数据</li>\n<li>业务服务器将写操作发给数据库主机，将读操作发给数据库从机</li>\n</ul>\n<p><img src=\"/2020/07/20/db-w-r-dynamic/db1.png\" alt></p>\n<h2 id=\"读写分离常见问题与解决\"><a href=\"#读写分离常见问题与解决\" class=\"headerlink\" title=\"读写分离常见问题与解决\"></a>读写分离常见问题与解决</h2><h3 id=\"主从延迟\"><a href=\"#主从延迟\" class=\"headerlink\" title=\"主从延迟\"></a>主从延迟</h3><p>以MYSQL为例，当主库插入数据后从库需要一段时间才能同步，时间可能达到1秒多，如果有大量数同步延迟1分钟也有可能。如果业务服务器将数据写入到数据库主服务器后立刻(1秒内)进行读取，此时读操作访问的是从机，主机还没有将数据复制过来，到从机读取数据是读不到最新数据的，业务上就可能出现问题。</p>\n<h3 id=\"常见解决方法\"><a href=\"#常见解决方法\" class=\"headerlink\" title=\"常见解决方法\"></a>常见解决方法</h3><ol>\n<li>关键业务读写操作指向主机，非关键业务采用读写分离。从业务上来区别理论上是比较好的。</li>\n<li>读从机失败后再读一次主机。这种方式与业务无偶尔，只需要在公共类上处理。不足之处在于如果有很多二次读取，将大大增加主机的读操作压力。</li>\n</ol>\n<h2 id=\"Spring实现读写分离\"><a href=\"#Spring实现读写分离\" class=\"headerlink\" title=\"Spring实现读写分离\"></a>Spring实现读写分离</h2><h3 id=\"实现代码\"><a href=\"#实现代码\" class=\"headerlink\" title=\"实现代码\"></a>实现代码</h3><h4 id=\"导出MAVEN包\"><a href=\"#导出MAVEN包\" class=\"headerlink\" title=\"导出MAVEN包\"></a>导出MAVEN包</h4><pre><code>import org.springframework.jdbc.datasource.lookup.AbstractRoutingDataSource;\n\n/***\n * 动态数据库\n */\npublic class DynamicDataSource extends AbstractRoutingDataSource {\n    protected Object determineCurrentLookupKey() {\n        return DBContextHolder.get();\n    }\n}</code></pre>"},{"title":"Hello World","date":"2020-07-18T02:14:00.000Z","_content":"这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。\n","source":"_posts/hello-world.md","raw":"title: Hello World\ntags:\n  - hexo\ncategories: []\ndate: 2020-07-18 10:14:00\n---\n这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。\n","slug":"hello-world","published":1,"updated":"2020-07-20T13:04:43.322Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcujgdbl0001e0xl307f2tdj","content":"<p>这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。</p>\n"},{"title":"你好，Hexo","date":"2015-09-02T16:08:30.000Z","_content":"这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。","source":"_posts/myblob.md","raw":"title: 你好，Hexo\ndate: 2015-09-03 00:08:30\ntags: \n  - hexo\n---\n这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。","slug":"myblob","published":1,"updated":"2020-07-20T13:04:43.322Z","comments":1,"layout":"post","photos":[],"link":"","_id":"ckcujgdbp0003e0xl824e0hn3","content":"<p>这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>这是我的第一篇博客，你好，Hexoxxxxddewrwerwerwer。</p>\n"}],"PostAsset":[{"_id":"source/_posts/db-w-r-dynamic/db1.png","post":"ckcujgdbf0000e0xlg085gsal","slug":"db1.png","modified":1,"renderable":1}],"PostCategory":[],"PostTag":[{"post_id":"ckcujgdbf0000e0xlg085gsal","tag_id":"ckcujgdbn0002e0xlhojchej4","_id":"ckcujgdbr0006e0xle9gc6mot"},{"post_id":"ckcujgdbf0000e0xlg085gsal","tag_id":"ckcujgdbq0004e0xlacni3caf","_id":"ckcujgdbs0007e0xla7jiczah"},{"post_id":"ckcujgdbl0001e0xl307f2tdj","tag_id":"ckcujgdbr0005e0xlhecqaty2","_id":"ckcujgdbu0009e0xl7y8ggjoe"},{"post_id":"ckcujgdbp0003e0xl824e0hn3","tag_id":"ckcujgdbr0005e0xlhecqaty2","_id":"ckcujgdbu000ae0xl5vr5ekzq"}],"Tag":[{"name":"mysql","_id":"ckcujgdbn0002e0xlhojchej4"},{"name":"架构","_id":"ckcujgdbq0004e0xlacni3caf"},{"name":"hexo","_id":"ckcujgdbr0005e0xlhecqaty2"}]}}